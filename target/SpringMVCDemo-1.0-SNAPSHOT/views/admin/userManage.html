<div>
    <table>
        <tr>
            <td>账户名称</td>
            <td><input id="user-account" placeholder="账户名称" type="text"/></td>
            <td><button id="query-user-btn" class="btn btn-primary" style="margin-left: 20px">查询</button></td>
            <td><button id="add-user-btn" class="btn btn-primary" style="margin-left: 20px">新增</button></td>
        </tr>
    </table>
</div>
<div id="grid-user">
    <table id="table-user" class="" style="height:200px;width:200px">
    </table>
    <div id="pg-user" style="text-align: right"></div>
</div>
<div id="user-remove"></div>
<div id="user-edit"></div>
<div id="user-remove-confirm"></div>
<div id="user-edit-confirm"></div>
<script>
    UserManageData = {
        paginationBar: $('#pg-user').mmPaginator({'limitList': [10]}),
        userTable: null,
        selectItem:null
    };
    UserManageUtil = {
        init: function () {
            UserManageUtil.initUserTable();
            $('#add-user-btn').on('click',function(){
                UserManageData.selectItem = null;
                createConfirmAndCancleDialogWitnLoad('user-edit','角色新增','admin/userEdit',{'userId':0},'UserEditUtil.saveUser()');
            });
            $('#query-user-btn').on('click',function () {
                UserManageData.userTable.load();
            })
        },
        deleteConfirmFunc:function(){
            $('#user-remove-modal').modal('hide');
            $.ajax({
                type: 'POST',
                url: 'admin/userDelete',
                data: {'id':UserManageData.selectItem.id},
                success: function (data) {
                    if(data.CODE == '1'){
                        createConfirmDialog('user-remove-confirm','确认框','删除成功');
                        UserManageData.userTable.load();
                    }else{
                        createConfirmDialog('user-remove-confirm','确认框',data.MESSAGE);
                    }
                },
                error: function () {
                    alert('failed');
                }
            });
        },
        initUserTable: function () {
            var cols = [
                {title: 'id', name: 'id', width: 200, hidden:true,sortable: false, aligin:'center'},
                {title: '账户名称', name: 'account', width: 200, sortable: true, aligin: 'left'},
                {title: '角色', name: 'roleName', width: 200, sortable: true, aligin: 'left',renderer:function (val,item,rowIndex) {
                    var role = item.role;
                    if(role){
                        return role.roleName;
                    }
                    return "";
                }},
                {title: '创建时间', name: 'createDate', width: 200, sortable: true, aligin: 'left'},
                {title: '操作',name: 'operator',width: 200,sortable: false,aligin: 'center',renderer: function (val, item, rowIndex) {
                    var modifyObj = '<a class="" href="#" title="修改"><span class="glyphicon glyphicon-pencil" style="font-size: 12px; color: #777; padding-right: 10px;"></span></a>';
                    var deleteObj = '<a class="" href="#" title="删除"><span class="glyphicon glyphicon-remove" style="font-size: 12px; color: #777; padding-right: 10px;"></span></a>';
                    return modifyObj + deleteObj;
                }
                }
            ];
            UserManageData.userTable = $('#table-user').mmGrid({
                height:'auto',
                cols:cols,
                url:'admin/userList',
                method:'get',
                params:function () {
                    data = {
                        'account':$('#user-account').val()
                    };
                    return data;
                },
                plugins: [UserManageData.paginationBar]
            });
            UserManageData.userTable.on('cellSelected',function(e,item,rowIndex,colIndex){
                UserManageData.selectItem = item;
                if($(e.target).is('.glyphicon-pencil')){
                    createConfirmAndCancleDialogWitnLoad('user-edit','用户修改','admin/userEdit',{'userId':UserManageData.selectItem.id},'UserEditUtil.saveUser()');
                }else if($(e.target).is('.glyphicon-remove')){
                    createConfirmAndCancleDialog('user-remove','确认框','确定要删除吗',"UserManageUtil.deleteConfirmFunc()");
                }
            });
        }

    };
    $(function () {
        UserManageUtil.init();
    })

</script>